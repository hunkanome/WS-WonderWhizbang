<!DOCTYPE html>
<html>

<head>
    <title>WonderWhizbang</title>
    <meta charset="utf-8">
    <meta name="description" content="Moteur de recherche dédié au patrimoine mondial de l'UNESCO">
    <meta name="keywords" content="UNESCO, patrimoine, culture">
    <meta name="author" content="Hunkanome">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script async src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="scripts/europeana.js"></script>
    <script src="scripts/dbpedia.js"></script>
    <script src="scripts/utils.js"></script>
</head>

<body>
    <h1>WonderWhizbang</h1>
    <p>Moteur de recherche dédié au patrimoine mondial de l'UNESCO</p>
    <input type="text" name="search" class="form-control" placeholder="Rechercher...">
    <button type="button" class="btn btn-primary">Rechercher</button>

    <!-- Random monument each time you refresh the page -->
    <div> 
        <h2>Discover This !</h2>
        <div class="card" style="width: 18rem;">
            <img src="https://via.placeholder.com/150" class="card-img-top" alt="...">
            <div class="card-body">
                <h5 class="card-title">Monument Name</h5>
                <p class="card-text">Monument Description</p>
                <a href="#" class="btn btn-primary">More</a>
            </div>
        </div>
    </div>

    <script>
        // Get a monument list from DBpedia
        var query = `
            PREFIX dbo: <http://dbpedia.org/ontology/>
            PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>

            SELECT ?monument ?monumentLabel WHERE {
            ?monument a dbo:Monument .
            ?monument rdfs:label ?monumentLabel .
            FILTER (lang(?monumentLabel) = "fr")
            }
            LIMIT 1000
        `;


        // Send the query to the SPARQL endpoint
        requestDBpedia(query)
        .then(data => {
            data = formatResult(data);
            console.log(data);
            // Select randomly a monument from the list and gather a picture and a description
            var randomMonument = data[Math.floor(Math.random() * data.length)];
            // var randomMonument = data[1];
            var monumentURI = randomMonument.monument.value;
            var monumentName = randomMonument.monumentLabel.value;

            // Get a picture from DBpedia
            var query = `
                PREFIX dbo: <http://dbpedia.org/ontology/>
                PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
                PREFIX foaf: <http://xmlns.com/foaf/0.1/>

                SELECT ?desc ?picture WHERE {
                <${monumentURI}> foaf:depiction ?picture .
                <${monumentURI}> dbo:abstract ?desc .
                FILTER (lang(?desc) = "fr")
                }
                LIMIT 1
            `;

            requestDBpedia(query)
            .then(data => {
                data = formatResult(data);
                console.log(data);
                var picture = data[0].picture.value;
                document.querySelector(".card-img-top").src = picture;
                document.querySelector(".card-title").innerHTML = monumentName;
                document.querySelector(".card-text").innerHTML = data[0].desc.value;
            });
        });
    </script>
</body>

</html>